parameters:
  package_name: morph
  module_path: ./src/morph

steps:
  # This is mostyl a check that the package.json is valid
  - script: "esy"
    displayName: Try building package - ${{ parameters.package_name}}
    workingDirectory: ${{ parameters.module_path }}

  - script: |
      cp ${{ parameters.package_name }}.opam ${{ parameters.module_path }}
      cp README.md ${{ parameters.module_path }}
      cp LICENSE ${{ parameters.module_path }}
    displayName: Copy needed files

  - script: "npm pack ."
    displayName: package ${{ parameters.package_name}} for npm
    workingDirectory: ${{ parameters.module_path }}

  - script: mv reason-native-web-${{ parameters.package_name}}-* ${{ parameters.package_name}}-package.tgz
    displayName: rename release package
    workingDirectory: ${{ parameters.module_path }}

  - publish: ${{ parameters.module_path }}/${{ parameters.package_name}}-package.tgz
    artifact: ${{ parameters.package_name}}_package
